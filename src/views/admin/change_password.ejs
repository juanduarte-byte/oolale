<div class="login-centered">
    <div class="kpi-card" style="max-width: 500px; width: 100%;">
        <div style="margin-bottom: 2rem;">
            <h2 style="font-size: 1.5rem; margin-bottom: 0.5rem; color: #fff;">Cambiar Contraseña</h2>
            <p style="color: var(--text-muted); font-size: 0.9rem;">Actualiza tu contraseña de acceso al panel</p>
        </div>

        <% if (typeof error !=='undefined' && error) { %>
            <div
                style="background: rgba(220, 38, 38, 0.1); border: 1px solid var(--danger); color: var(--danger); padding: 12px; border-radius: 8px; margin-bottom: 1.5rem;">
                <i class="bi bi-exclamation-triangle-fill"></i>
                <% if (error==='incorrect' ) { %>
                    La contraseña actual es incorrecta.
                    <% } else if (error==='mismatch' ) { %>
                        Las contraseñas nuevas no coinciden.
                        <% } else { %>
                            Error al cambiar la contraseña.
                            <% } %>
            </div>
            <% } %>

                <% if (typeof success !=='undefined' && success) { %>
                    <div
                        style="background: rgba(34, 197, 94, 0.1); border: 1px solid var(--success); color: var(--success); padding: 12px; border-radius: 8px; margin-bottom: 1.5rem;">
                        <i class="bi bi-check-circle-fill"></i> Contraseña actualizada correctamente.
                    </div>
                    <% } %>

                        <form action="/admin/profile/change-password" method="POST">
                            <div style="margin-bottom: 1.5rem;">
                                <label
                                    style="color: var(--text-muted); display: block; margin-bottom: 0.5rem;">Contraseña
                                    Actual</label>
                                <div style="position: relative;">
                                    <input type="password" id="currentPassword" name="current_password" required
                                        style="width: 100%; padding: 12px 40px 12px 12px; background: #000; border: 1px solid var(--border); border-radius: 8px; color: #fff; outline: none;">
                                    <button type="button" onclick="togglePassword('currentPassword')"
                                        style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-muted); cursor: pointer;">
                                        <i class="bi bi-eye" id="currentPassword-icon"></i>
                                    </button>
                                </div>
                            </div>

                            <div style="margin-bottom: 1.5rem;">
                                <label style="color: var(--text-muted); display: block; margin-bottom: 0.5rem;">Nueva
                                    Contraseña</label>
                                <div style="position: relative;">
                                    <input type="password" id="newPassword" name="new_password" required minlength="6"
                                        style="width: 100%; padding: 12px 40px 12px 12px; background: #000; border: 1px solid var(--border); border-radius: 8px; color: #fff; outline: none;">
                                    <button type="button" onclick="togglePassword('newPassword')"
                                        style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-muted); cursor: pointer;">
                                        <i class="bi bi-eye" id="newPassword-icon"></i>
                                    </button>
                                </div>
                                <small style="color: var(--text-muted); font-size: 0.8rem;">Mínimo 6 caracteres</small>
                            </div>

                            <div style="margin-bottom: 2rem;">
                                <label
                                    style="color: var(--text-muted); display: block; margin-bottom: 0.5rem;">Confirmar
                                    Nueva Contraseña</label>
                                <div style="position: relative;">
                                    <input type="password" id="confirmPassword" name="confirm_password" required
                                        style="width: 100%; padding: 12px 40px 12px 12px; background: #000; border: 1px solid var(--border); border-radius: 8px; color: #fff; outline: none;">
                                    <button type="button" onclick="togglePassword('confirmPassword')"
                                        style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-muted); cursor: pointer;">
                                        <i class="bi bi-eye" id="confirmPassword-icon"></i>
                                    </button>
                                </div>
                            </div>

                            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                <a href="/admin/dashboard" class="btn"
                                    style="background: rgba(255,255,255,0.1); color: #fff; text-decoration: none;">Cancelar</a>
                                <button type="submit" class="btn btn-primary" style="padding: 12px 24px;">Cambiar
                                    Contraseña</button>
                            </div>
                        </form>
    </div>
</div>

<script>
    function togglePassword(inputId) {
        const input = document.getElementById(inputId);
        const icon = document.getElementById(inputId + '-icon');

        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('bi-eye');
            icon.classList.add('bi-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.remove('bi-eye-slash');
            icon.classList.add('bi-eye');
        }
    }
</script>